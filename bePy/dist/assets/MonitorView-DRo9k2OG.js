import{E as te,r as z,G as N,d as se,l as E,H as oe,A as ne,c as a,a as t,e as m,F as y,n as k,f as x,b as T,j as L,t as c,p as O,T as U,s as D,J as ae,g as Y,v as I,C as le,o as l}from"./index-DlhYqpTP.js";import{u as re}from"./devices-Du8uUnEM.js";import{a as A}from"./apiFetch-Bt_Yeku8.js";import{a as ie,C as de,S as ce}from"./settings-Ew1MCnWC.js";import{C as ue}from"./chevron-left-D4WbBg2L.js";import{M as G}from"./monitor-C3Cc_AVu.js";import{X as ve}from"./x-BBvezXzC.js";import{C as V}from"./clock-_4ziDbA1.js";import{c as fe}from"./createLucideIcon-DLPysJiA.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe=fe("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),be=te("monitor",()=>{const F=z(null),h=z(null);async function C(u,g){const i=await A(`${N.BASE_URL}/api/devices/${u}/channels/month_data/${g}`);return F.value=i,i}async function $(){const u=await A(`${N.BASE_URL}/api/config`);return h.value=u,u}async function p(u,g,i){const _={start_day:u,end_day:g,order:i},d=await A(`${N.BASE_URL}/api/config`,{method:"POST",body:JSON.stringify(_)});return h.value&&(h.value.start_day=u,h.value.end_day=g,h.value.order=i),d}return{monthData:F,config:h,fetchMonthData:C,fetchConfig:$,updateConfig:p}}),xe={class:"h-full flex gap-6 overflow-hidden"},he={class:"glass-card w-72 flex flex-col overflow-hidden shrink-0 border-white/5"},ge={class:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar"},_e=["onClick"],we={class:"flex items-center gap-2 w-full"},ye={class:"font-medium truncate"},ke={class:"text-[10px] mt-1 opacity-60"},ze={class:"flex-1 flex flex-col overflow-hidden glass-card border-white/5"},Se={class:"p-6 border-b border-white/5 bg-white/[0.02] flex items-center justify-between"},Ce={class:"flex items-center gap-4"},$e={class:"text-xl font-bold flex items-center gap-2"},De={key:0,class:"h-6 w-px bg-white/10 mx-2"},Me={key:1,class:"text-zinc-400 text-sm"},je={class:"text-zinc-200 font-semibold"},Te={class:"flex items-center gap-3 bg-zinc-900/50 p-1 rounded-xl border border-white/5"},Re={class:"text-sm font-bold min-w-[120px] text-center uppercase tracking-widest text-teal-400"},Ee={class:"flex-1 overflow-auto bg-zinc-950/20 custom-scrollbar p-6"},Le={key:0,class:"h-full flex flex-col items-center justify-center text-zinc-600 space-y-4"},Fe={key:1,class:"space-y-8"},Ne={class:"flex items-center gap-3 ml-1"},Ae={class:"font-bold text-sm tracking-tight text-zinc-400"},Ve={class:"grid grid-cols-7 sm:grid-cols-10 md:grid-cols-15 lg:grid-cols-31 gap-1.5 auto-rows-fr"},Be=["onClick"],Pe={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-6"},Oe={class:"glass-card w-full max-w-4xl p-8 relative z-10 shadow-3xl bg-zinc-900/90 border-teal-500/20"},Ue={class:"flex items-center justify-between mb-8"},Ye={class:"flex items-center gap-4 mb-8 p-4 bg-white/5 rounded-2xl border border-white/5"},Ie={class:"w-12 h-12 rounded-xl bg-teal-500/10 flex items-center justify-center text-teal-400"},Ge={class:"text-[10px] text-zinc-500 uppercase font-black tracking-[0.2em]"},qe={class:"text-xl font-bold text-zinc-200"},He={class:"flex gap-2 mb-6 p-1 bg-zinc-950/50 rounded-xl border border-white/5"},Je={class:"relative pt-10 pb-6 mb-8 px-4 bg-zinc-950/30 rounded-3xl border border-white/5"},Xe={class:"absolute top-4 left-4 right-4 flex justify-between px-1"},Ke={class:"relative h-12 bg-zinc-900 rounded-xl overflow-hidden shadow-inner border border-white/5"},Qe={class:"absolute inset-0 flex"},We={class:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 px-3 py-1.5 bg-zinc-950 text-emerald-400 text-[10px] font-black rounded-lg border border-emerald-500/30 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-20 shadow-2xl"},Ze={key:0,class:"space-y-4"},et={class:"flex items-center justify-between px-2"},tt={class:"text-xs font-black uppercase tracking-widest text-zinc-600"},st={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-48 overflow-y-auto custom-scrollbar pr-2"},ot={class:"flex items-center gap-3"},nt={class:"text-sm font-mono text-zinc-300"},at={key:1,class:"space-y-4"},lt={class:"flex items-center justify-between px-2"},rt={class:"text-xs font-black uppercase tracking-widest text-zinc-600"},it={key:0,class:"text-center py-12 bg-white/[0.02] border border-white/5 rounded-2xl border-dashed"},dt={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-48 overflow-y-auto custom-scrollbar pr-2"},ct={class:"flex items-center gap-3 mb-2"},ut={class:"text-sm font-mono text-zinc-300"},vt={class:"pl-5"},ft={class:"text-xs font-black text-amber-400 uppercase tracking-wider"},mt={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-6"},pt={class:"glass-card w-full max-w-sm p-8 relative z-10"},bt={class:"space-y-4"},xt={class:"flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5 mt-6"},ht=se({__name:"MonitorView",setup(F){const h=le("notify"),C=re(),$=be(),p=z(null),u=z(new Date),g=z(!1),i=z(null),_=z("segments"),d=z({start_day:1,end_day:31,order:!1}),M=E(()=>{const o=u.value.getFullYear(),e=String(u.value.getMonth()+1).padStart(2,"0");return`${o}-${e}`}),q=E(()=>{new Date(u.value.getFullYear(),u.value.getMonth()+1,0).getDate();let o=d.value.start_day,e=d.value.end_day;const s=d.value.order,n=[];if(o<=e)for(let r=o;r<=e;r++)n.push(r);return s&&n.reverse(),n}),H=E(()=>$.monthData?.channels||[]);oe([p,M],async([o,e])=>{if(o&&e)try{await $.fetchMonthData(o.id,e)}catch{h("Error","Failed to load archive data","error")}},{immediate:!0}),ne(async()=>{try{const o=await $.fetchConfig();o&&(d.value={start_day:o.start_day,end_day:o.end_day,order:o.order})}catch{}try{await C.fetchActiveDevices()}catch{}C.devices.length>0&&!p.value&&(p.value=C.devices[0])});const J=()=>{u.value=new Date(u.value.getFullYear(),u.value.getMonth()-1,1)},X=()=>{u.value=new Date(u.value.getFullYear(),u.value.getMonth()+1,1)},S=o=>{let e=o;if(o.includes(" ")){const s=o.split(" ");s[1]&&(e=s[1])}else if(o.includes("T")){const s=o.split("T");s[1]&&(e=s[1])}if(e.includes(".")){const s=e.split(".");s[0]&&(e=s[0])}return e},w=o=>{const e=S(o),[s,n,r]=e.split(":").map(Number);return(s||0)*3600+(n||0)*60+(r||0)},K=(o,e)=>{const s=String(e).padStart(2,"0"),n=`${M.value}-${s}`,r=o.record_days.find(b=>b.record_date===n);if(!r||!r.has_record||!r.time_ranges.length)return"bg-zinc-900 border-white/5 text-zinc-600 pointer-events-none";const f=r.time_ranges;if(f.length===1){const b=f[0],v=w(b.start_time),j=w(b.end_time);if(v<=0&&j>=86399)return"bg-emerald-500/20 border-emerald-500/40 text-emerald-400 hover:scale-110 active:scale-95"}return"bg-rose-500/10 border-rose-500/30 text-rose-400 hover:scale-110 active:scale-95"},Q=(o,e)=>{const s=String(e).padStart(2,"0"),n=`${M.value}-${s}`,r=o.record_days.find(v=>v.record_date===n);if(!r||!r.has_record)return;const f=[...r.time_ranges].sort((v,j)=>v.start_time.localeCompare(j.start_time)),b=f.map(v=>{const j=w(v.start_time),Z=w(v.end_time),B=86400,P=j/B*100,ee=Z/B*100;return{label:`${S(v.start_time)} - ${S(v.end_time)}`,start:P,width:Math.max(ee-P,.5)}});i.value={channel:o.channel.name||`CH ${o.channel.channel_no}`,day:e,ranges:b,rawRanges:f},_.value="segments"},R=E(()=>{if(!i.value||!i.value.rawRanges)return[];const o=i.value.rawRanges,e=[],s=n=>{const r=Math.floor(n/3600),f=Math.floor(n%3600/60),b=n%60,v=[];return r>0&&v.push(`${r}h`),f>0&&v.push(`${f}m`),b>0&&v.push(`${b}s`),v.length>0?v.join(" "):"0s"};if(o.length>0){const n=w(o[0].start_time);n>0&&e.push({label:`00:00:00 - ${S(o[0].start_time)}`,duration:s(n),durationSec:n})}for(let n=0;n<o.length-1;n++){const r=w(o[n].end_time),f=w(o[n+1].start_time);if(f>r){const b=f-r;e.push({label:`${S(o[n].end_time)} - ${S(o[n+1].start_time)}`,duration:s(b),durationSec:b})}}if(o.length>0){const n=w(o[o.length-1].end_time),r=86399;if(n<r){const f=r-n;e.push({label:`${S(o[o.length-1].end_time)} - 23:59:59`,duration:s(f),durationSec:f})}}return e}),W=async()=>{if(d.value.start_day>d.value.end_day){h("Validation Error","Start Day must be <= End Day","error");return}try{await $.updateConfig(d.value.start_day,d.value.end_day,d.value.order),h("Saved","Monitor configuration updated","success"),g.value=!1}catch{h("Error","Failed to save configuration","error")}};return(o,e)=>(l(),a("div",xe,[t("div",he,[e[10]||(e[10]=t("div",{class:"p-4 border-b border-white/5 bg-white/[0.02]"},[t("h3",{class:"font-bold text-zinc-200"},"Devices")],-1)),t("div",ge,[(l(!0),a(y,null,k(x(C).devices,s=>(l(),a("button",{key:s.id,onClick:n=>p.value=s,class:D(["w-full flex flex-col items-start p-3 rounded-lg transition-all duration-200",[p.value?.id===s.id?"bg-teal-500/20 text-teal-400 border border-teal-500/30":"hover:bg-white/5 text-zinc-400 border border-transparent"]])},[t("div",we,[m(x(G),{class:"w-4 h-4 shrink-0"}),t("span",ye,c(s.ipNvr),1)]),t("span",ke,c(s.brand)+" â€¢ Online",1)],10,_e))),128))])]),t("div",ze,[t("div",Se,[t("div",Ce,[t("h3",$e,[m(x(ie),{class:"w-5 h-5 text-teal-400"}),e[11]||(e[11]=L(" Archive Recording ",-1))]),p.value?(l(),a("div",De)):T("",!0),p.value?(l(),a("span",Me,[e[12]||(e[12]=L(" Device: ",-1)),t("span",je,c(p.value.ipNvr),1)])):T("",!0)]),t("div",Te,[t("button",{onClick:J,class:"p-2 hover:bg-white/5 rounded-lg text-zinc-500 hover:text-zinc-200 transition-colors"},[m(x(ue),{class:"w-5 h-5"})]),t("span",Re,c(M.value),1),t("button",{onClick:X,class:"p-2 hover:bg-white/5 rounded-lg text-zinc-500 hover:text-zinc-200 transition-colors"},[m(x(de),{class:"w-5 h-5"})]),t("button",{onClick:e[0]||(e[0]=s=>g.value=!0),class:"p-2 hover:bg-white/5 rounded-lg text-zinc-500 hover:text-teal-400 transition-colors"},[m(x(ce),{class:"w-4 h-4"})])])]),t("div",Ee,[p.value?(l(),a("div",Fe,[(l(!0),a(y,null,k(H.value,s=>(l(),a("div",{key:s.channel.id,class:"space-y-3"},[t("div",Ne,[e[14]||(e[14]=t("div",{class:"w-2 h-2 rounded-full bg-teal-500"},null,-1)),t("h4",Ae,c(s.channel.name||`Channel ${s.channel.channel_no}`),1)]),t("div",Ve,[(l(!0),a(y,null,k(q.value,n=>(l(),a("div",{key:n,class:D(["aspect-square rounded-md flex items-center justify-center text-[10px] font-bold border transition-all cursor-pointer z-[1]",K(s,n)]),onClick:r=>Q(s,n)},c(n),11,Be))),128))])]))),128))])):(l(),a("div",Le,[m(x(G),{class:"w-16 h-16 opacity-20"}),e[13]||(e[13]=t("p",{class:"italic"},"Please select a device from the sidebar to view archive",-1))]))])]),m(U,{name:"modal"},{default:O(()=>[i.value?(l(),a("div",Pe,[t("div",{class:"absolute inset-0 bg-zinc-950/80 backdrop-blur-sm",onClick:e[1]||(e[1]=s=>i.value=null)}),t("div",Oe,[t("div",Ue,[e[15]||(e[15]=t("h3",{class:"text-2xl font-black text-zinc-100 italic"},"Daily Timeline Diagnostic",-1)),t("button",{onClick:e[2]||(e[2]=s=>i.value=null),class:"text-zinc-500 hover:text-rose-400"},[m(x(ve),{class:"w-8 h-8"})])]),t("div",Ye,[t("div",Ie,[m(x(V),{class:"w-6 h-6"})]),t("div",null,[t("p",Ge," Channel "+c(i.value.channel)+" / "+c(p.value?.ipNvr),1),t("p",qe," Recording Analysis: Day "+c(i.value.day)+", "+c(M.value),1)])]),t("div",He,[t("button",{onClick:e[3]||(e[3]=s=>_.value="segments"),class:D(["flex-1 py-3 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2",_.value==="segments"?"bg-teal-500/20 text-teal-400 border border-teal-500/30":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"])},[m(x(V),{class:"w-4 h-4"}),L(" Detected Segments ("+c(i.value.ranges.length)+") ",1)],2),t("button",{onClick:e[4]||(e[4]=s=>_.value="timeloss"),class:D(["flex-1 py-3 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2",_.value==="timeloss"?"bg-teal-500/20 text-teal-400 border border-teal-500/30":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"])},[m(x(pe),{class:"w-4 h-4"}),L(" Time Loss ("+c(R.value.length)+") ",1)],2)]),t("div",Je,[t("div",Xe,[(l(),a(y,null,k(24,s=>t("span",{key:s,class:"text-[8px] font-mono text-zinc-700 w-0 flex justify-center"},c((s-1).toString().padStart(2,"0")),1)),64)),e[16]||(e[16]=t("span",{class:"text-[8px] font-mono text-zinc-700 w-0 flex justify-center"},"24",-1))]),t("div",Ke,[t("div",Qe,[(l(),a(y,null,k(24,s=>t("div",{key:s,class:"flex-1 border-r border-white/5 last:border-0 h-full"})),64))]),(l(!0),a(y,null,k(i.value.ranges,s=>(l(),a("div",{key:s.label,class:"absolute top-1.5 bottom-1.5 bg-emerald-500/80 hover:bg-emerald-400 cursor-pointer rounded-md transition-all border border-emerald-400/30 group z-10",style:ae({left:`${s.start}%`,width:`${s.width}%`})},[t("div",We,c(s.label),1)],4))),128))])]),_.value==="segments"?(l(),a("div",Ze,[t("div",et,[t("span",tt,"Detected Segments ("+c(i.value.ranges.length)+")",1),e[17]||(e[17]=t("span",{class:"text-[10px] text-zinc-500 italic"},"Times are in Local System Time (LST)",-1))]),t("div",st,[(l(!0),a(y,null,k(i.value.ranges,s=>(l(),a("div",{key:s.label,class:"flex items-center justify-between p-4 rounded-2xl bg-white/5 border border-white/5 group hover:bg-emerald-500/5 hover:border-emerald-500/20 transition-all"},[t("div",ot,[e[18]||(e[18]=t("div",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),t("span",nt,c(s.label),1)])]))),128))])])):_.value==="timeloss"?(l(),a("div",at,[t("div",lt,[t("span",rt,"Time Loss / Gaps ("+c(R.value.length)+")",1),e[19]||(e[19]=t("span",{class:"text-[10px] text-zinc-500 italic"},"Recording gaps detected",-1))]),R.value.length===0?(l(),a("div",it,[m(x(V),{class:"w-12 h-12 mx-auto text-emerald-500/50 mb-4"}),e[20]||(e[20]=t("p",{class:"text-emerald-400 font-bold"},"No time loss detected!",-1)),e[21]||(e[21]=t("p",{class:"text-xs text-zinc-500 mt-2"},"Recording is continuous for this day.",-1))])):(l(),a("div",dt,[(l(!0),a(y,null,k(R.value,(s,n)=>(l(),a("div",{key:n,class:"flex flex-col p-4 rounded-2xl bg-amber-500/5 border border-amber-500/20 group hover:bg-amber-500/10 hover:border-amber-500/30 transition-all"},[t("div",ct,[e[22]||(e[22]=t("div",{class:"w-2 h-2 rounded-full bg-amber-500"},null,-1)),t("span",ut,c(s.label),1)]),t("div",vt,[t("span",ft,"Duration: "+c(s.duration),1)])]))),128))]))])):T("",!0),t("button",{onClick:e[5]||(e[5]=s=>i.value=null),class:"w-full mt-10 py-4 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-2xl transition-all border border-white/5"}," Close Diagnostics ")])])):T("",!0)]),_:1}),m(U,{name:"modal"},{default:O(()=>[g.value?(l(),a("div",mt,[t("div",{class:"absolute inset-0 bg-zinc-950/60 backdrop-blur-sm",onClick:e[6]||(e[6]=s=>g.value=!1)}),t("div",pt,[e[26]||(e[26]=t("h3",{class:"text-xl font-bold mb-6"},"Display Settings",-1)),t("div",bt,[t("div",null,[e[23]||(e[23]=t("label",{class:"block text-xs font-bold text-zinc-500 uppercase tracking-widest mb-1.5"},"Start Day",-1)),Y(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=s=>d.value.start_day=s),min:"1",max:"31",class:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm focus:outline-none focus:border-teal-500/50"},null,512),[[I,d.value.start_day]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-xs font-bold text-zinc-500 uppercase tracking-widest mb-1.5"},"End Day",-1)),Y(t("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=s=>d.value.end_day=s),min:"1",max:"31",class:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm focus:outline-none focus:border-teal-500/50"},null,512),[[I,d.value.end_day]])]),t("div",xt,[e[25]||(e[25]=t("span",{class:"text-sm"},"Reverse Order",-1)),t("div",{onClick:e[9]||(e[9]=s=>d.value.order=!d.value.order),class:D(["w-10 h-6 rounded-full relative p-1 cursor-pointer transition-colors",d.value.order?"bg-teal-500":"bg-zinc-700"])},[t("div",{class:D(["w-4 h-4 bg-white rounded-full absolute transition-transform",d.value.order?"translate-x-4":"translate-x-0"])},null,2)],2)])]),t("button",{onClick:W,class:"w-full mt-8 py-3 bg-teal-500 text-zinc-950 font-bold rounded-xl shadow-lg shadow-teal-500/20"}," Save Configuration ")])])):T("",!0)]),_:1})]))}}),Mt=me(ht,[["__scopeId","data-v-fb314d70"]]);export{Mt as default};
