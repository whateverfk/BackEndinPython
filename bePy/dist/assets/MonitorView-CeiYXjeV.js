import{E as W,r as w,G as F,d as Z,l as R,H as ee,A as te,c as l,a as e,e as m,F as g,n as _,f as x,b as $,j as A,t as u,p as L,T as B,s as D,J as se,g as P,v as O,C as oe,o as a}from"./index-DEHT6mqA.js";import{u as ne}from"./devices-Dr04_U9H.js";import{a as E}from"./apiFetch-BMI3tozZ.js";import{a as le,C as ae,S as re}from"./settings-EHoGOYRd.js";import{C as ie}from"./chevron-left-Bdp2BvrP.js";import{M as U}from"./monitor-Qw_HIcTz.js";import{X as de}from"./x-BkwpVxN4.js";import{C as ce}from"./clock-8HUgDDxZ.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-DO80ASjG.js";const ve=W("monitor",()=>{const M=w(null),f=w(null);async function y(r,b){const i=await E(`${F.BASE_URL}/api/devices/${r}/channels/month_data/${b}`);return M.value=i,i}async function z(){const r=await E(`${F.BASE_URL}/api/config`);return f.value=r,r}async function v(r,b,i){const n={start_day:r,end_day:b,order:i},h=await E(`${F.BASE_URL}/api/config`,{method:"POST",body:JSON.stringify(n)});return f.value&&(f.value.start_day=r,f.value.end_day=b,f.value.order=i),h}return{monthData:M,config:f,fetchMonthData:y,fetchConfig:z,updateConfig:v}}),fe={class:"h-full flex gap-6 overflow-hidden"},pe={class:"glass-card w-72 flex flex-col overflow-hidden shrink-0 border-white/5"},me={class:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar"},be=["onClick"],xe={class:"flex items-center gap-2 w-full"},he={class:"font-medium truncate"},ge={class:"text-[10px] mt-1 opacity-60"},_e={class:"flex-1 flex flex-col overflow-hidden glass-card border-white/5"},we={class:"p-6 border-b border-white/5 bg-white/[0.02] flex items-center justify-between"},ye={class:"flex items-center gap-4"},ze={class:"text-xl font-bold flex items-center gap-2"},ke={key:0,class:"h-6 w-px bg-white/10 mx-2"},Ce={key:1,class:"text-zinc-400 text-sm"},Se={class:"text-zinc-200 font-semibold"},$e={class:"flex items-center gap-3 bg-zinc-900/50 p-1 rounded-xl border border-white/5"},De={class:"text-sm font-bold min-w-[120px] text-center uppercase tracking-widest text-teal-400"},Me={class:"flex-1 overflow-auto bg-zinc-950/20 custom-scrollbar p-6"},je={key:0,class:"h-full flex flex-col items-center justify-center text-zinc-600 space-y-4"},Te={key:1,class:"space-y-8"},Fe={class:"flex items-center gap-3 ml-1"},Re={class:"font-bold text-sm tracking-tight text-zinc-400"},Ee={class:"grid grid-cols-7 sm:grid-cols-10 md:grid-cols-15 lg:grid-cols-31 gap-1.5 auto-rows-fr"},Ne=["onClick"],Ve={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-6"},Ae={class:"glass-card w-full max-w-4xl p-8 relative z-10 shadow-3xl bg-zinc-900/90 border-teal-500/20"},Le={class:"flex items-center justify-between mb-8"},Be={class:"flex items-center gap-4 mb-8 p-4 bg-white/5 rounded-2xl border border-white/5"},Pe={class:"w-12 h-12 rounded-xl bg-teal-500/10 flex items-center justify-center text-teal-400"},Oe={class:"text-[10px] text-zinc-500 uppercase font-black tracking-[0.2em]"},Ue={class:"text-xl font-bold text-zinc-200"},Ye={class:"relative pt-10 pb-6 mb-8 px-4 bg-zinc-950/30 rounded-3xl border border-white/5"},Ie={class:"absolute top-4 left-4 right-4 flex justify-between px-1"},Ge={class:"relative h-12 bg-zinc-900 rounded-xl overflow-hidden shadow-inner border border-white/5"},He={class:"absolute inset-0 flex"},Je={class:"absolute bottom-full left-1/2 -translate-x-1/2 mb-3 px-3 py-1.5 bg-zinc-950 text-emerald-400 text-[10px] font-black rounded-lg border border-emerald-500/30 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-20 shadow-2xl"},qe={class:"space-y-4"},Xe={class:"flex items-center justify-between px-2"},Ke={class:"text-xs font-black uppercase tracking-widest text-zinc-600"},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-48 overflow-y-auto custom-scrollbar pr-2"},We={class:"flex items-center gap-3"},Ze={class:"text-sm font-mono text-zinc-300"},et={key:0,class:"fixed inset-0 z-[100] flex items-center justify-center p-6"},tt={class:"glass-card w-full max-w-sm p-8 relative z-10"},st={class:"space-y-4"},ot={class:"flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5 mt-6"},nt=Z({__name:"MonitorView",setup(M){const f=oe("notify"),y=ne(),z=ve(),v=w(null),r=w(new Date),b=w(!1),i=w(null),n=w({start_day:1,end_day:31,order:!1}),h=R(()=>{const o=r.value.getFullYear(),t=String(r.value.getMonth()+1).padStart(2,"0");return`${o}-${t}`}),Y=R(()=>{new Date(r.value.getFullYear(),r.value.getMonth()+1,0).getDate();let o=n.value.start_day,t=n.value.end_day;const s=n.value.order,d=[];if(o<=t)for(let c=o;c<=t;c++)d.push(c);return s&&d.reverse(),d}),I=R(()=>z.monthData?.channels||[]);ee([v,h],async([o,t])=>{if(o&&t)try{await z.fetchMonthData(o.id,t)}catch{f("Error","Failed to load archive data","error")}},{immediate:!0}),te(async()=>{try{const o=await z.fetchConfig();o&&(n.value={start_day:o.start_day,end_day:o.end_day,order:o.order})}catch{}try{await y.fetchActiveDevices()}catch{}y.devices.length>0&&!v.value&&(v.value=y.devices[0])});const G=()=>{r.value=new Date(r.value.getFullYear(),r.value.getMonth()-1,1)},H=()=>{r.value=new Date(r.value.getFullYear(),r.value.getMonth()+1,1)},j=o=>{let t=o;if(o.includes(" ")){const s=o.split(" ");s[1]&&(t=s[1])}else if(o.includes("T")){const s=o.split("T");s[1]&&(t=s[1])}if(t.includes(".")){const s=t.split(".");s[0]&&(t=s[0])}return t},S=o=>{const t=j(o),[s,d,c]=t.split(":").map(Number);return(s||0)*3600+(d||0)*60+(c||0)},J=(o,t)=>{const s=String(t).padStart(2,"0"),d=`${h.value}-${s}`,c=o.record_days.find(k=>k.record_date===d);if(!c||!c.has_record||!c.time_ranges.length)return"bg-zinc-900 border-white/5 text-zinc-600 pointer-events-none";const T=c.time_ranges;if(T.length===1){const k=T[0],p=S(k.start_time),C=S(k.end_time);if(p<=0&&C>=86399)return"bg-emerald-500/20 border-emerald-500/40 text-emerald-400 hover:scale-110 active:scale-95"}return"bg-rose-500/10 border-rose-500/30 text-rose-400 hover:scale-110 active:scale-95"},q=(o,t)=>{const s=String(t).padStart(2,"0"),d=`${h.value}-${s}`,c=o.record_days.find(p=>p.record_date===d);if(!c||!c.has_record)return;const k=[...c.time_ranges].sort((p,C)=>p.start_time.localeCompare(C.start_time)).map(p=>{const C=S(p.start_time),K=S(p.end_time),N=86400,V=C/N*100,Q=K/N*100;return{label:`${j(p.start_time)} - ${j(p.end_time)}`,start:V,width:Math.max(Q-V,.5)}});i.value={channel:o.channel.name||`CH ${o.channel.channel_no}`,day:t,ranges:k}},X=async()=>{if(n.value.start_day>n.value.end_day){f("Validation Error","Start Day must be <= End Day","error");return}try{await z.updateConfig(n.value.start_day,n.value.end_day,n.value.order),f("Saved","Monitor configuration updated","success"),b.value=!1}catch{f("Error","Failed to save configuration","error")}};return(o,t)=>(a(),l("div",fe,[e("div",pe,[t[8]||(t[8]=e("div",{class:"p-4 border-b border-white/5 bg-white/[0.02]"},[e("h3",{class:"font-bold text-zinc-200"},"Devices")],-1)),e("div",me,[(a(!0),l(g,null,_(x(y).devices,s=>(a(),l("button",{key:s.id,onClick:d=>v.value=s,class:D(["w-full flex flex-col items-start p-3 rounded-lg transition-all duration-200",[v.value?.id===s.id?"bg-teal-500/20 text-teal-400 border border-teal-500/30":"hover:bg-white/5 text-zinc-400 border border-transparent"]])},[e("div",xe,[m(x(U),{class:"w-4 h-4 shrink-0"}),e("span",he,u(s.ipNvr),1)]),e("span",ge,u(s.brand)+" â€¢ Online",1)],10,be))),128))])]),e("div",_e,[e("div",we,[e("div",ye,[e("h3",ze,[m(x(le),{class:"w-5 h-5 text-teal-400"}),t[9]||(t[9]=A(" Archive Monitoring ",-1))]),v.value?(a(),l("div",ke)):$("",!0),v.value?(a(),l("span",Ce,[t[10]||(t[10]=A(" Device: ",-1)),e("span",Se,u(v.value.ipNvr),1)])):$("",!0)]),e("div",$e,[e("button",{onClick:G,class:"p-2 hover:bg-white/5 rounded-lg text-zinc-500 hover:text-zinc-200 transition-colors"},[m(x(ie),{class:"w-5 h-5"})]),e("span",De,u(h.value),1),e("button",{onClick:H,class:"p-2 hover:bg-white/5 rounded-lg text-zinc-500 hover:text-zinc-200 transition-colors"},[m(x(ae),{class:"w-5 h-5"})]),e("button",{onClick:t[0]||(t[0]=s=>b.value=!0),class:"p-2 hover:bg-white/5 rounded-lg text-zinc-500 hover:text-teal-400 transition-colors"},[m(x(re),{class:"w-4 h-4"})])])]),e("div",Me,[v.value?(a(),l("div",Te,[(a(!0),l(g,null,_(I.value,s=>(a(),l("div",{key:s.channel.id,class:"space-y-3"},[e("div",Fe,[t[12]||(t[12]=e("div",{class:"w-2 h-2 rounded-full bg-teal-500"},null,-1)),e("h4",Re,u(s.channel.name||`Channel ${s.channel.channel_no}`),1)]),e("div",Ee,[(a(!0),l(g,null,_(Y.value,d=>(a(),l("div",{key:d,class:D(["aspect-square rounded-md flex items-center justify-center text-[10px] font-bold border transition-all cursor-pointer z-[1]",J(s,d)]),onClick:c=>q(s,d)},u(d),11,Ne))),128))])]))),128))])):(a(),l("div",je,[m(x(U),{class:"w-16 h-16 opacity-20"}),t[11]||(t[11]=e("p",{class:"italic"},"Please select a device from the sidebar to view archive",-1))]))])]),m(B,{name:"modal"},{default:L(()=>[i.value?(a(),l("div",Ve,[e("div",{class:"absolute inset-0 bg-zinc-950/80 backdrop-blur-sm",onClick:t[1]||(t[1]=s=>i.value=null)}),e("div",Ae,[e("div",Le,[t[13]||(t[13]=e("h3",{class:"text-2xl font-black text-zinc-100 italic"},"Daily Timeline Diagnostic",-1)),e("button",{onClick:t[2]||(t[2]=s=>i.value=null),class:"text-zinc-500 hover:text-rose-400"},[m(x(de),{class:"w-8 h-8"})])]),e("div",Be,[e("div",Pe,[m(x(ce),{class:"w-6 h-6"})]),e("div",null,[e("p",Oe," Channel "+u(i.value.channel)+" / "+u(v.value?.ipNvr),1),e("p",Ue," Recording Analysis: Day "+u(i.value.day)+", "+u(h.value),1)])]),e("div",Ye,[e("div",Ie,[(a(),l(g,null,_(24,s=>e("span",{key:s,class:"text-[8px] font-mono text-zinc-700 w-0 flex justify-center"},u((s-1).toString().padStart(2,"0")),1)),64)),t[14]||(t[14]=e("span",{class:"text-[8px] font-mono text-zinc-700 w-0 flex justify-center"},"24",-1))]),e("div",Ge,[e("div",He,[(a(),l(g,null,_(24,s=>e("div",{key:s,class:"flex-1 border-r border-white/5 last:border-0 h-full"})),64))]),(a(!0),l(g,null,_(i.value.ranges,s=>(a(),l("div",{key:s.label,class:"absolute top-1.5 bottom-1.5 bg-emerald-500/80 hover:bg-emerald-400 cursor-pointer rounded-md transition-all border border-emerald-400/30 group z-10",style:se({left:`${s.start}%`,width:`${s.width}%`})},[e("div",Je,u(s.label),1)],4))),128))])]),e("div",qe,[e("div",Xe,[e("span",Ke,"Detected Segments ("+u(i.value.ranges.length)+")",1),t[15]||(t[15]=e("span",{class:"text-[10px] text-zinc-500 italic"},"Times are in Local System Time (LST)",-1))]),e("div",Qe,[(a(!0),l(g,null,_(i.value.ranges,s=>(a(),l("div",{key:s.label,class:"flex items-center justify-between p-4 rounded-2xl bg-white/5 border border-white/5 group hover:bg-emerald-500/5 hover:border-emerald-500/20 transition-all"},[e("div",We,[t[16]||(t[16]=e("div",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",Ze,u(s.label),1)])]))),128))])]),e("button",{onClick:t[3]||(t[3]=s=>i.value=null),class:"w-full mt-10 py-4 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 font-bold rounded-2xl transition-all border border-white/5"}," Close Diagnostics ")])])):$("",!0)]),_:1}),m(B,{name:"modal"},{default:L(()=>[b.value?(a(),l("div",et,[e("div",{class:"absolute inset-0 bg-zinc-950/60 backdrop-blur-sm",onClick:t[4]||(t[4]=s=>b.value=!1)}),e("div",tt,[t[20]||(t[20]=e("h3",{class:"text-xl font-bold mb-6"},"Display Settings",-1)),e("div",st,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs font-bold text-zinc-500 uppercase tracking-widest mb-1.5"},"Start Day",-1)),P(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>n.value.start_day=s),min:"1",max:"31",class:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm focus:outline-none focus:border-teal-500/50"},null,512),[[O,n.value.start_day]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-bold text-zinc-500 uppercase tracking-widest mb-1.5"},"End Day",-1)),P(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=s=>n.value.end_day=s),min:"1",max:"31",class:"w-full bg-white/5 border border-white/10 rounded-xl p-3 text-sm focus:outline-none focus:border-teal-500/50"},null,512),[[O,n.value.end_day]])]),e("div",ot,[t[19]||(t[19]=e("span",{class:"text-sm"},"Reverse Order",-1)),e("div",{onClick:t[7]||(t[7]=s=>n.value.order=!n.value.order),class:D(["w-10 h-6 rounded-full relative p-1 cursor-pointer transition-colors",n.value.order?"bg-teal-500":"bg-zinc-700"])},[e("div",{class:D(["w-4 h-4 bg-white rounded-full absolute transition-transform",n.value.order?"translate-x-4":"translate-x-0"])},null,2)],2)])]),e("button",{onClick:X,class:"w-full mt-8 py-3 bg-teal-500 text-zinc-950 font-bold rounded-xl shadow-lg shadow-teal-500/20"}," Save Configuration ")])])):$("",!0)]),_:1})]))}}),mt=ue(nt,[["__scopeId","data-v-974349c3"]]);export{mt as default};
