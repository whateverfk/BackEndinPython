import{E as K,r as m,G as $,d as de,H as ee,c as i,b as A,a as e,t as v,e as y,f as t,F as O,n as D,j as T,s as P,C as be,i as H,o as n,l as te,I as Le,g as j,v as Z,D as X,J as se,m as Ie,A as Me,k as Re,q as Oe}from"./index-BFsMhItK.js";import{u as De}from"./devices-CcGhwENU.js";import{a as C}from"./apiFetch-BMI3tozZ.js";import{X as ge}from"./x-C4LXewsj.js";import{L as V}from"./loader-circle-CG5zHxBC.js";import{R as oe}from"./refresh-cw-DR17SAUs.js";import{C as ye,S as Pe,a as Ne}from"./settings-CNy9oDla.js";import{S as Ue}from"./settings-2-CKD2svx7.js";import{c as B}from"./createLucideIcon-CPANF60c.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import q from"https://cdn.jsdelivr.net/npm/hls.js@1/+esm";import{M as Y}from"./monitor-BiXBNo71.js";import{C as Te}from"./chevron-left-DSNf2Oqf.js";import{I as ve}from"./info-CtflVk2p.js";import{S as je}from"./search-CzvoQbiV.js";import{C as he}from"./clock-5wWdgjRR.js";const Be=B("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const Ve=B("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);const Fe=B("construction",[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]]);const He=B("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const xe=B("hard-drive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);const Ge=B("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]);const Je=B("network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);const me=B("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);const We=B("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);const ce=B("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const qe=B("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Ye=K("deviceDetail",()=>{const S=m(null),w=m([]),r=m([]),E=m([]),o=m({info:!1,storage:!1,onvif:!1,users:!1});async function c(g){o.value.info=!0;try{const I=await C(`${$.BASE_URL}/api/device/${g}/infor`);S.value=I}finally{o.value.info=!1}}async function x(g){o.value.info=!0;try{const I=await C(`${$.BASE_URL}/api/device/${g}/infor/sync`,{method:"POST"});I.status==="ok"&&I.data&&(S.value={device_id:Number(g),...I.data})}finally{o.value.info=!1}}async function k(g){o.value.storage=!0;try{const I=await C(`${$.BASE_URL}/api/device/${g}/infor/storage`);w.value=I}finally{o.value.storage=!1}}async function _(g){await C(`${$.BASE_URL}/api/device/${g}/infor/storage`,{method:"POST"}),await k(g)}async function u(g){o.value.onvif=!0;try{const I=await C(`${$.BASE_URL}/api/device/${g}/infor/onvif-users`);r.value=I}finally{o.value.onvif=!1}}async function h(g){await C(`${$.BASE_URL}/api/device/${g}/infor/onvif-users`,{method:"POST"}),await u(g)}async function p(g){o.value.users=!0;try{const I=await C(`${$.BASE_URL}/api/device/${g}/user`);E.value=I}finally{o.value.users=!1}}async function f(g){await C(`${$.BASE_URL}/api/device/${g}/user/sync`,{method:"POST"}),await p(g)}return{systemInfo:S,storageList:w,onvifUsers:r,deviceUsers:E,loading:o,fetchSystemInfo:c,syncSystemInfo:x,fetchStorage:k,syncStorage:_,fetchOnvifUsers:u,syncOnvifUsers:h,fetchDeviceUsers:p,syncDeviceUsers:f}}),Xe=K("deviceLogs",()=>{const S=m([]),w=m(0),r=m(!1),E=m(new Date(new Date().setDate(new Date().getDate()-1))),o=m(new Date),c=m(100),x=m("ALL"),k={alarmOut:"Alarm Output",alarmIn:"Alarm Input",motionStart:"Start Motion Detection",motionStop:"Stop Motion Detection",hideStart:"Start Video Tampering",hideStop:"Stop Video Tampering",vcaStart:"Start VCA Alarm",vcaStop:"Stop VCA Alarm",remoteLogin:"Remote: Login",remoteLogout:"Remote: Logout",lineDetectionStart:"Line Crossing Detection Started",lineDetectionStop:"Line Crossing Detection Stopped",fieldDetectionStart:"Intrusion Detection Started",fieldDetectionStop:"Intrusion Detection Stop",audioInputExceptionStart:"Audio Input Exception Started",audioInputExceptionStop:"Audio Input Exception Stop",soundIntensityMutationStart:"Sudden change of Sound Intensity Detection Started",soundIntensityMutationStop:"Sudden change of Sound Intensity Detection Stop",runStatusInfo:"System Running State",hddInfo:"HDD information",ipcDisconnect:"IP Camera Disconnect",videoLost:"Video Signal Loss",illlegealAccess:"Illegal Login",netBroken:"Network Disconnected",recordError:"Record/Capture Error",hdFull:"HDD Full",hdError:"HDD Error",ipConflict:"IP Address Conflicted",videoException:"Video Signal Exception",videoFormatMismatch:"Input/Output Video Standard Mismatch",ipcIpConfilict:"Ip Address of IPC Conflict",viAndResMismatch:"Video resolution Mismatch",spareException:"Hot Spare Exception",startIpcMasException:"IPC Motion Analysis Exception",anrRecordException:"ANR Record Exception",recordOverFLow:"Record Buffer Overflow",ipcmCrash:"IPCM Abnormal Reboot",poePowerException:"POE Power Exception",uploadDataCsException:"Data Upload Exception",dialException:"Wireless Dial-Up Exception"};function _(h){return k[h]||h}async function u(h){r.value=!0;try{const p={from:E.value.toISOString(),to:o.value.toISOString(),maxResults:c.value,majorType:x.value},f=await C(`${$.BASE_URL}/api/logs/device/${h}`,{method:"POST",body:JSON.stringify(p)});S.value=f.logs,w.value=f.total}finally{r.value=!1}}return{logs:S,total:w,loading:r,dateFrom:E,dateTo:o,maxResults:c,majorType:x,fetchLogs:u,getMinorLabel:_}}),_e=K("scheduler",()=>{const S=m([]),w=m({}),r=m({channels:!1,mode:!1,sync:!1,syncAll:!1}),E={CMR:{label:"Continuous",color:"bg-emerald-500"},MOTION:{label:"Motion",color:"bg-amber-500"},ALARM:{label:"Alarm",color:"bg-rose-500"},EDR:{label:"Motion | Alarm",color:"bg-purple-500"},ALARMANDMOTION:{label:"Motion & Alarm",color:"bg-blue-500"},AllEvent:{label:"Event",color:"bg-cyan-500"}},o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];async function c(u){r.value.channels=!0;try{const h=await C(`${$.BASE_URL}/api/devices/${u}/channels`);console.log("[fetchChannels] raw data:",h),console.log("[fetchChannels] type:",typeof h),console.log("[fetchChannels] isArray:",Array.isArray(h)),Array.isArray(h)&&(S.value=h.sort((p,f)=>p.channel_no-f.channel_no))}finally{r.value.channels=!1}}async function x(u,h){if(!w.value[h]){r.value.mode=!0;try{const p=await C(`${$.BASE_URL}/api/device/${u}/channel/${h}/infor/recording-mode`);w.value[h]=p}finally{r.value.mode=!1}}}async function k(u,h){r.value.sync=!0;try{await C(`${$.BASE_URL}/api/device/${u}/channel/${h}/infor/recording-mode/sync`,{method:"POST"}),await x(u,h)}finally{r.value.sync=!1}}async function _(u){r.value.syncAll=!0;try{await C(`${$.BASE_URL}/api/device/${u}/channels/recording-mode/sync`,{method:"POST"}),await c(u)}finally{r.value.syncAll=!1}}return{channels:S,channelModes:w,loading:r,MODE_CONFIG:E,DAYS:o,fetchChannels:c,fetchRecordingMode:x,syncRecordingMode:k,syncAllRecordingModes:_}}),we=K("live",()=>{const S=m(null),w=m(null),r=m({config:!1,update:!1,sync:!1}),E={90:"Highest",75:"Higher",60:"Medium",45:"Low",30:"Lower",20:"Lowest"};async function o(p,f){r.value.config=!0;try{const g=await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/infor`);S.value=g}finally{r.value.config=!1}}async function c(p,f){try{const g=await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/infor/capabilities`);w.value=g}catch{}}async function x(p,f,g){r.value.update=!0;try{await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/infor`,{method:"PUT",body:JSON.stringify(g)}),S.value=g}finally{r.value.update=!1}}async function k(p,f){r.value.sync=!0;try{await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/infor/sync`),await o(p,f)}finally{r.value.sync=!1}}async function _(p,f){try{await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/stop`,{method:"POST"})}catch{}}async function u(p,f){try{await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/heartbeat`,{method:"POST"})}catch{}}async function h(p,f){return await C(`${$.BASE_URL}/api/device/${p}/channel/${f}/live`)}return{channelConfig:S,capabilities:w,loading:r,FIXED_QUALITY_LABELS:E,fetchConfig:o,fetchCapabilities:c,updateConfig:x,syncConfig:k,stopStream:_,sendHeartbeat:u,startStream:h}}),ke=K("devicePermissions",()=>{const S=m(null),w=m({fetch:!1,update:!1,sync:!1,syncAll:!1}),r={upgrade:"Upgrade / Format",parameter_config:"Parameter Configuration",restart_or_shutdown:"Shutdown / Reboot",log_or_state_check:"Log / Status Check",manage_channel:"Camera Management",playback:"Playback",record:"Manual Record",backup:"Video Export",ptz_control:"PTZ Control",preview:"Live View",voice_talk:"Two-way Audio",alarm_out_or_upload:"Notify Surveillance Center / Trigger Alarm Output",control_local_out:"Video Output Control",transparent_channel:"Serial Port Control"},E={local:["upgrade","parameter_config","restart_or_shutdown","log_or_state_check","manage_channel","playback","record","backup","ptz_control"],remote:["parameter_config","log_or_state_check","upgrade","voice_talk","restart_or_shutdown","alarm_out_or_upload","control_local_out","transparent_channel","manage_channel","preview","record","playback","ptz_control"]},o=["preview","playback","record","backup","ptz_control"],c="You do not have enough privilege to perform this operation",x="Invalid operation";async function k(p,f){w.value.fetch=!0;try{const g=await C(`${$.BASE_URL}/api/device/${p}/user/${f}/permissions`);S.value=g}finally{w.value.fetch=!1}}async function _(p,f){w.value.sync=!0;try{await C(`${$.BASE_URL}/api/device/${p}/user/${f}/permissions/sync`,{method:"POST"}),await k(p,f)}finally{w.value.sync=!1}}async function u(p,f,g){w.value.update=!0;const I={device_id:p,device_user_id:f,permissions:g};try{const U=await C(`${$.BASE_URL}/api/device/${p}/user/${f}/permissions`,{method:"PUT",body:JSON.stringify(I)});return U.success!==!1&&!U.error?{success:!0,code:"OK",message:"Permission updated successfully"}:U.error==="LOW_PRIVILEGE"?{success:!1,code:"LOW_PRIVILEGE",message:c}:{success:!1,code:"INVALID_OPERATION",message:x}}catch(U){return{success:!1,code:"ERROR",message:U.message||"An unexpected error occurred"}}finally{w.value.update=!1}}async function h(p){w.value.syncAll=!0;try{const f=`${$.BASE_URL}/api/device/${p}/user/syncall`;await C(f,{method:"POST"})}finally{w.value.syncAll=!1}}return{permissions:S,loading:w,PERMISSION_LABELS:r,SCOPE_PERMISSION_WHITELIST:E,CHANNEL_BASED_PERMISSIONS:o,fetchPermissions:k,syncPermissions:_,updatePermissions:u,syncAllUsers:h}}),Qe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm"},Ze={class:"bg-zinc-900 border border-white/10 rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden"},Ke={class:"p-6 border-b border-white/10 flex justify-between items-center bg-white/[0.02]"},et={key:0,class:"text-sm text-zinc-500 font-mono mt-1"},tt={class:"flex-1 overflow-hidden flex flex-col"},st={key:0,class:"flex-1 flex flex-col items-center justify-center text-teal-500"},ot={key:1,class:"flex-1 flex overflow-hidden"},nt={class:"w-48 border-r border-white/10 bg-black/20 p-2 space-y-1"},lt=["onClick"],at={class:"flex-1 overflow-y-auto custom-scrollbar p-6"},it={class:"grid grid-cols-1 gap-4"},rt={class:"flex items-start justify-between"},ct={class:"flex items-center gap-3"},dt=["checked","onChange"],ut={class:"font-bold text-zinc-200 text-sm"},pt={class:"text-[10px] text-zinc-500 font-mono"},ft={key:0},vt=["onClick"],ht={key:0,class:"mt-4 pt-4 border-t border-white/5 pl-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2"},xt=["checked","onChange"],bt={class:"truncate"},gt={class:"p-6 border-t border-white/10 bg-white/[0.02] flex justify-between items-center"},yt={class:"flex gap-3"},mt=["disabled"],_t=de({__name:"UserPermissionModal",props:{isOpen:{type:Boolean},deviceId:{},user:{}},emits:["close","saved"],setup(S,{emit:w}){const r=S,E=w,o=ke(),c=_e(),x=be("notify"),k=m("local"),_=m([]),u=m(null),h=m([]);ee(()=>r.isOpen,async a=>{a&&r.user?(await o.fetchPermissions(r.deviceId,r.user.id),o.permissions&&(u.value=JSON.parse(JSON.stringify(o.permissions))),c.channels.length===0&&await c.fetchChannels(r.deviceId),h.value=c.channels):(u.value=null,_.value=[])});function p(){E("close")}function f(a){return u.value?!!u.value[k.value].global[a]:!1}function g(a){if(!u.value)return;const d=k.value,z=!!!u.value[d].global[a];u.value[d].global={...u.value[d].global,[a]:z},o.CHANNEL_BASED_PERMISSIONS.includes(a)&&(z?u.value[d].channels[a]=h.value.map(J=>J.id):u.value[d].channels[a]=[])}function I(a){if(!u.value)return 0;const d=u.value[k.value].channels[a];return d?d.length:0}function U(a){_.value.includes(a)?_.value=_.value.filter(d=>d!==a):_.value.push(a)}function G(a,d){return u.value?(u.value[k.value].channels[a]||[]).includes(d):!1}function Q(a,d){if(!u.value)return;const b=k.value;let z=[...u.value[b].channels[a]||[]];z.includes(d)?z=z.filter(ne=>ne!==d):z.push(d),u.value[b].channels[a]=z;const J=z.length>0;u.value[b].global={...u.value[b].global,[a]:J}}async function F(){r.user&&(await o.syncPermissions(r.deviceId,r.user.id),o.permissions&&(u.value=JSON.parse(JSON.stringify(o.permissions))))}async function M(){if(!u.value||!r.user)return;const a=await o.updatePermissions(r.deviceId,r.user.id,u.value);a.success?(x?.("Success",a.message,"success"),E("saved"),p()):x?.("Error",a.message,"error")}return(a,d)=>S.isOpen?(n(),i("div",Qe,[e("div",Ze,[e("div",Ke,[e("div",null,[d[0]||(d[0]=e("h3",{class:"text-xl font-black text-zinc-100 uppercase tracking-tight"},"User Permissions",-1)),S.user?(n(),i("p",et,"User: "+v(S.user.user_name),1)):A("",!0)]),e("button",{onClick:p,class:"p-2 hover:bg-white/10 rounded-lg text-zinc-400 hover:text-white transition-colors"},[y(t(ge),{class:"w-6 h-6"})])]),e("div",tt,[t(o).loading.fetch?(n(),i("div",st,[y(t(V),{class:"w-10 h-10 animate-spin mb-4"}),d[1]||(d[1]=e("span",null,"Loading permissions...",-1))])):u.value?(n(),i("div",ot,[e("div",nt,[(n(),i(O,null,D(["local","remote"],b=>e("button",{key:b,onClick:z=>k.value=b,class:P(["w-full text-left px-4 py-3 rounded-xl transition-all font-bold uppercase tracking-wider text-xs flex items-center justify-between",k.value===b?"bg-teal-500 text-zinc-950":"text-zinc-500 hover:bg-white/5 hover:text-zinc-300"])},[T(v(b)+" ",1),k.value===b?(n(),H(t(ye),{key:0,class:"w-4 h-4"})):A("",!0)],10,lt)),64))]),e("div",at,[e("div",it,[(n(!0),i(O,null,D(t(o).SCOPE_PERMISSION_WHITELIST[k.value],b=>(n(),i("div",{key:b,class:"p-4 rounded-xl border border-white/5 bg-white/[0.02] hover:bg-white/[0.04] transition-colors"},[e("div",rt,[e("div",ct,[e("input",{type:"checkbox",checked:f(b),onChange:z=>g(b),class:"w-5 h-5 accent-teal-500 rounded cursor-pointer"},null,40,dt),e("div",null,[e("p",ut,v(t(o).PERMISSION_LABELS[b]||b),1),e("p",pt,v(b),1)])]),t(o).CHANNEL_BASED_PERMISSIONS.includes(b)?(n(),i("div",ft,[e("button",{onClick:z=>U(b),class:"text-xs bg-white/5 hover:bg-white/10 border border-white/10 px-3 py-1.5 rounded-lg text-zinc-300 flex items-center gap-2 transition-colors"},[y(t(Ue),{class:"w-3 h-3"}),T(" "+v(I(b))+" Channels ",1),y(t(Ve),{class:P(["w-3 h-3 transition-transform",{"rotate-180":_.value.includes(b)}])},null,8,["class"])],8,vt)])):A("",!0)]),_.value.includes(b)?(n(),i("div",ht,[(n(!0),i(O,null,D(h.value,z=>(n(),i("label",{key:z.id,class:"flex items-center gap-2 text-xs text-zinc-400 cursor-pointer hover:text-zinc-200"},[e("input",{type:"checkbox",checked:G(b,z.id),onChange:J=>Q(b,z.id),class:"accent-teal-500 rounded-sm"},null,40,xt),e("span",bt,v(z.channel_name||z.channel_no),1)]))),128))])):A("",!0)]))),128))])])])):A("",!0)]),e("div",gt,[e("button",{onClick:F,class:"text-teal-500 hover:text-teal-400 text-sm font-bold flex items-center gap-2"},[y(t(oe),{class:P(["w-4 h-4",{"animate-spin":t(o).loading.sync}])},null,8,["class"]),d[2]||(d[2]=T(" Sync from Device ",-1))]),e("div",yt,[e("button",{onClick:p,class:"px-6 py-2 rounded-xl font-bold text-zinc-400 hover:text-zinc-200 hover:bg-white/5 transition-colors"},"Cancel"),e("button",{onClick:M,disabled:t(o).loading.update,class:"px-6 py-2 bg-teal-500 text-zinc-950 font-bold rounded-xl hover:bg-teal-400 transition-colors disabled:opacity-50"},v(t(o).loading.update?"Saving...":"Save Changes"),9,mt)])])])])):A("",!0)}}),wt=ue(_t,[["__scopeId","data-v-53677eb8"]]),kt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-md"},St={class:"bg-zinc-900 border border-white/10 rounded-3xl w-full max-w-6xl max-h-[95vh] flex flex-col shadow-2xl overflow-hidden relative"},$t={class:"p-6 border-b border-white/10 flex justify-between items-center bg-white/[0.02]"},zt={class:"flex items-center gap-4"},Ct={class:"w-12 h-12 rounded-2xl bg-teal-500/20 flex items-center justify-center"},At={class:"text-xs text-zinc-500 font-mono"},Et={class:"flex-1 flex flex-col lg:flex-row overflow-hidden"},Lt={class:"flex-[3] bg-black relative group flex items-center justify-center p-4"},It={class:"w-full aspect-video bg-zinc-950 rounded-2xl border border-white/5 overflow-hidden relative shadow-2xl shadow-teal-500/5"},Mt={class:"absolute inset-0 flex flex-col items-center justify-center -z-10"},Rt={key:2,class:"text-zinc-600 font-mono text-[10px] mt-2"},Ot={class:"absolute bottom-0 inset-x-0 p-6 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex justify-end"},Dt={class:"flex gap-2"},Pt={class:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors",title:"Settings"},Nt={class:"p-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors",title:"Go Fullscreen"},Ut={class:"flex-[2] border-l border-white/10 bg-white/[0.01] flex flex-col overflow-hidden"},Tt={class:"p-4 border-b border-white/5 bg-white/[0.02] flex items-center justify-between"},jt=["disabled"],Bt={key:0,class:"flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar"},Vt={class:"space-y-1"},Ft={class:"grid grid-cols-2 gap-4"},Ht={class:"space-y-1"},Gt=["value"],Jt={class:"space-y-1"},Wt=["value"],qt={class:"grid grid-cols-2 gap-4"},Yt={class:"space-y-1"},Xt=["value"],Qt={class:"space-y-1"},Zt=["value"],Kt={class:"grid grid-cols-1 gap-4"},es={key:0,class:"space-y-1"},ts={key:1,class:"space-y-1"},ss={class:"space-y-4 pt-4 border-t border-white/5"},os={class:"flex items-center justify-between p-3 bg-white/5 rounded-xl"},ns={class:"flex items-center gap-3"},ls={class:"flex items-center justify-between p-3 bg-white/5 rounded-xl"},as={class:"flex items-center gap-3"},is={class:"p-6 border-t border-white/5 bg-white/[0.02] flex justify-end"},rs=["disabled"],cs=de({__name:"ChannelLiveModal",props:{isOpen:{type:Boolean},deviceId:{},channel:{}},emits:["close","saved"],setup(S,{emit:w}){const r=S,E=w,o=we(),c=m(null),x=te(()=>o.capabilities),k=m(!1),_=m(null);let u=null,h=null;const p=te({get:()=>c.value?`${c.value.resolution_width}x${c.value.resolution_height}`:"",set:M=>{if(!c.value||!M)return;const[a,d]=M.split("x").map(Number);c.value.resolution_width=a,c.value.resolution_height=d}});ee(()=>r.isOpen,async M=>{M&&r.channel?(k.value=!0,await o.fetchConfig(r.deviceId,r.channel.id),await o.fetchCapabilities(r.deviceId,r.channel.id),o.channelConfig&&(c.value=JSON.parse(JSON.stringify(o.channelConfig))),f(),g(),k.value=!1):F()});function f(){!_.value||!r.channel||o.startStream(r.deviceId,r.channel.id).then(M=>{if(M.status==="ok"&&M.hls_url){const a=`${$.BASE_URL}${M.hls_url}`;q.isSupported()?(h=new q({enableWorker:!0,lowLatencyMode:!0,backBufferLength:60}),h.loadSource(a),h.attachMedia(_.value),h.on(q.Events.MANIFEST_PARSED,()=>{_.value?.play().catch(()=>{console.log("Autoplay blocked, user interaction required")})}),h.on(q.Events.ERROR,(d,b)=>{if(b.fatal)switch(b.type){case q.ErrorTypes.NETWORK_ERROR:console.error("Fatal network error encountered, try to recover"),h.startLoad();break;case q.ErrorTypes.MEDIA_ERROR:console.error("Fatal media error encountered, try to recover"),h.recoverMediaError();break;default:console.error("Fatal error, destroying Hls"),F();break}})):_.value.canPlayType("application/vnd.apple.mpegurl")&&(_.value.src=a,_.value.addEventListener("loadedmetadata",()=>{_.value?.play()}))}}).catch(M=>{console.error("Failed to start stream:",M)})}function g(){I(),u=setInterval(()=>{r.isOpen&&r.channel&&o.sendHeartbeat(r.deviceId,r.channel.id)},5e3)}function I(){u&&clearInterval(u),u=null}async function U(){r.channel&&(await o.syncConfig(r.deviceId,r.channel.id),o.channelConfig&&(c.value=JSON.parse(JSON.stringify(o.channelConfig))))}async function G(){if(!(!c.value||!r.channel))try{await o.updateConfig(r.deviceId,r.channel.id,c.value),E("saved")}catch{}}function Q(){F(),E("close")}async function F(){if(I(),h&&(h.destroy(),h=null),_.value&&(_.value.src="",_.value.load()),r.channel)try{await o.stopStream(r.deviceId,r.channel.id)}catch{}}return Le(()=>{F()}),(M,a)=>S.isOpen?(n(),i("div",kt,[e("div",St,[e("div",$t,[e("div",zt,[e("div",Ct,[y(t(Y),{class:"w-6 h-6 text-teal-400"})]),e("div",null,[a[9]||(a[9]=e("h3",{class:"text-xl font-black text-zinc-100 uppercase tracking-tight"}," Live Stream & Configuration ",-1)),e("p",At,"Channel: "+v(S.channel?.name||S.channel?.channel_no),1)])]),e("button",{onClick:Q,class:"p-2 hover:bg-white/10 rounded-xl text-zinc-400 hover:text-white transition-all"},[y(t(ge),{class:"w-6 h-6"})])]),e("div",Et,[e("div",Lt,[e("div",It,[e("div",Mt,[k.value?(n(),H(t(V),{key:0,class:"w-12 h-12 animate-spin text-teal-500 mb-4"})):(n(),H(t(me),{key:1,class:"w-16 h-16 text-teal-500 mx-auto opacity-20 mb-4"})),k.value?A("",!0):(n(),i("p",Rt," /api/device/"+v(S.deviceId)+"/channel/"+v(S.channel?.id)+"/live ",1))]),e("video",{ref_key:"videoRef",ref:_,class:"w-full h-full object-contain bg-black",autoplay:"",muted:"",playsinline:""},null,512),e("div",Ot,[e("div",Dt,[e("button",Pt,[y(t(Pe),{class:"w-4 h-4"})]),e("button",Nt,[y(t(Ge),{class:"w-4 h-4"})])])])]),a[10]||(a[10]=e("div",{class:"absolute top-8 left-8 flex gap-2"},[e("div",{class:"px-3 py-1 bg-black/60 backdrop-blur rounded-full border border-white/10 text-[10px] font-black uppercase text-zinc-400 tracking-widest flex items-center gap-2"},[e("div",{class:"w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"}),T(" Live ")])],-1))]),e("div",Ut,[e("div",Tt,[a[12]||(a[12]=e("span",{class:"text-xs font-bold uppercase tracking-widest text-zinc-500"},"Video Settings",-1)),e("button",{onClick:U,disabled:t(o).loading.sync,class:"text-[10px] font-black uppercase tracking-tight text-teal-400 hover:text-teal-300 transition-colors flex items-center gap-1 disabled:opacity-50"},[y(t(oe),{class:P(["w-3 h-3",{"animate-spin":t(o).loading.sync}])},null,8,["class"]),a[11]||(a[11]=T(" Sync ",-1))],8,jt)]),c.value?(n(),i("div",Bt,[e("div",Vt,[a[13]||(a[13]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"Channel Name",-1)),j(e("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=d=>c.value.channel_name=d),class:"form-input",placeholder:"Enter channel name"},null,512),[[Z,c.value.channel_name]])]),e("div",Ft,[e("div",Ht,[a[14]||(a[14]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"Codec",-1)),j(e("select",{"onUpdate:modelValue":a[1]||(a[1]=d=>c.value.video_codec=d),class:"form-input"},[(n(!0),i(O,null,D(x.value?.video_codec,d=>(n(),i("option",{key:d,value:d},v(d),9,Gt))),128))],512),[[X,c.value.video_codec]])]),e("div",Jt,[a[15]||(a[15]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"Resolution",-1)),j(e("select",{"onUpdate:modelValue":a[2]||(a[2]=d=>p.value=d),class:"form-input"},[(n(!0),i(O,null,D(x.value?.resolutions,(d,b)=>(n(),i("option",{key:b,value:`${d.width}x${d.height}`},v(d.width)+" x "+v(d.height),9,Wt))),128))],512),[[X,p.value]])])]),e("div",qt,[e("div",Yt,[a[16]||(a[16]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"FPS Limit",-1)),j(e("select",{"onUpdate:modelValue":a[3]||(a[3]=d=>c.value.max_frame_rate=d),class:"form-input"},[(n(!0),i(O,null,D(x.value?.max_frame_rates,d=>(n(),i("option",{key:d,value:d},v(d/100)+" FPS",9,Xt))),128))],512),[[X,c.value.max_frame_rate]])]),e("div",Qt,[a[17]||(a[17]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"Quality",-1)),j(e("select",{"onUpdate:modelValue":a[4]||(a[4]=d=>c.value.fixed_quality=d),class:"form-input"},[(n(!0),i(O,null,D(x.value?.fixed_quality.options,d=>(n(),i("option",{key:d,value:d},v(t(o).FIXED_QUALITY_LABELS[d]||d),9,Zt))),128))],512),[[X,c.value.fixed_quality]])])]),e("div",Kt,[c.value.h265_plus?(n(),i("div",es,[a[18]||(a[18]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"Avg Bitrate (kbps)",-1)),j(e("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=d=>c.value.vbr_average_cap=d),class:"form-input"},null,512),[[Z,c.value.vbr_average_cap]])])):(n(),i("div",ts,[a[19]||(a[19]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-wider"},"Max Bitrate (kbps)",-1)),j(e("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=d=>c.value.vbr_upper_cap=d),class:"form-input"},null,512),[[Z,c.value.vbr_upper_cap]])]))]),e("div",ss,[e("div",os,[e("div",ns,[y(t(ce),{class:"w-4 h-4 text-teal-400"}),a[20]||(a[20]=e("span",{class:"text-sm font-medium text-zinc-300"},"H.265+ Compression",-1))]),e("button",{onClick:a[7]||(a[7]=d=>c.value.h265_plus=!c.value.h265_plus),class:P(["w-10 h-5 rounded-full transition-colors relative",c.value.h265_plus?"bg-teal-500":"bg-zinc-700"])},[e("div",{class:"absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform",style:se({transform:c.value.h265_plus?"translateX(20px)":"none"})},null,4)],2)]),e("div",ls,[e("div",as,[y(t(Fe),{class:"w-4 h-4 text-amber-400"}),a[21]||(a[21]=e("span",{class:"text-sm font-medium text-zinc-300"},"Motion Detection",-1))]),e("button",{onClick:a[8]||(a[8]=d=>c.value.motion_detect=!c.value.motion_detect),class:P(["w-10 h-5 rounded-full transition-colors relative",c.value.motion_detect?"bg-teal-500":"bg-zinc-700"])},[e("div",{class:"absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform",style:se({transform:c.value.motion_detect?"translateX(20px)":"none"})},null,4)],2)])])])):A("",!0),e("div",is,[e("button",{onClick:G,disabled:t(o).loading.update,class:"px-8 py-3 bg-teal-500 text-zinc-950 font-black uppercase text-xs tracking-widest rounded-xl hover:bg-teal-400 transition-all disabled:opacity-50 flex items-center gap-2"},[t(o).loading.update?(n(),H(t(V),{key:1,class:"w-4 h-4 animate-spin"})):(n(),H(t(We),{key:0,class:"w-4 h-4"})),T(" "+v(t(o).loading.update?"Applying...":"Apply Config"),1)],8,rs)])])])])])):A("",!0)}}),ds=ue(cs,[["__scopeId","data-v-271054e1"]]),us={class:"h-full"},ps={class:"h-full flex gap-6 overflow-hidden"},fs={class:"p-4 border-b border-white/5 bg-white/[0.02]"},vs={key:0,class:"text-xs font-bold uppercase tracking-widest"},hs={class:"flex items-center justify-between gap-2 overflow-hidden"},xs={class:"font-bold text-zinc-200 text-lg flex items-center gap-2 whitespace-nowrap"},bs={key:0},gs=["title"],ys={key:0,class:"text-[10px] text-zinc-500 mt-1 pl-7 truncate"},ms={class:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar"},_s=["onClick","title"],ws={key:0},ks={class:"flex-1 flex flex-col overflow-hidden glass-card border-white/5 relative"},Ss={class:"px-8 py-6 border-b border-white/5 bg-white/[0.02] flex items-center justify-between"},$s={class:"text-2xl font-black text-zinc-100 italic tracking-tight uppercase"},zs={class:"flex gap-3"},Cs=["disabled"],As=["disabled"],Es={class:"flex-1 overflow-y-auto p-8 custom-scrollbar"},Ls={key:0,class:"max-w-3xl space-y-8"},Is={key:0,class:"flex flex-col items-center justify-center py-20 text-zinc-500"},Ms={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Rs={class:"bg-white/5 border border-white/5 p-6 rounded-2xl space-y-1"},Os={class:"text-xl font-mono text-zinc-200"},Ds={class:"bg-white/5 border border-white/5 p-6 rounded-2xl space-y-1"},Ps={class:"text-xl font-mono text-zinc-200"},Ns={class:"bg-white/5 border border-white/5 p-6 rounded-2xl space-y-1"},Us={class:"text-xl font-mono text-zinc-200"},Ts={class:"bg-white/5 border border-white/5 p-6 rounded-2xl space-y-1"},js={class:"text-xl font-mono text-zinc-200"},Bs={key:2,class:"text-center py-20 bg-white/[0.02] border border-white/5 rounded-3xl border-dashed"},Vs={key:1,class:"space-y-6"},Fs={key:0,class:"flex flex-col items-center justify-center py-20 text-zinc-500"},Hs={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Gs={class:"flex items-center justify-between"},Js={class:"font-bold text-zinc-300"},Ws={class:"text-xs px-2 py-1 rounded bg-teal-500/20 text-teal-400 border border-teal-500/30 uppercase font-black"},qs={class:"space-y-1 text-sm text-zinc-400"},Ys={class:"flex justify-between"},Xs={class:"text-zinc-200"},Qs={class:"flex justify-between"},Zs={class:"text-zinc-200"},Ks={class:"flex justify-between"},eo={class:"text-zinc-200"},to={class:"flex justify-between"},so={class:"text-zinc-200"},oo={class:"h-1.5 w-full bg-zinc-800 rounded-full overflow-hidden"},no={key:2,class:"text-center py-20 bg-white/[0.02] border border-white/5 rounded-3xl border-dashed"},lo={key:2,class:"space-y-6"},ao={key:0,class:"flex flex-col items-center justify-center py-20 text-zinc-500"},io={key:1,class:"overflow-hidden bg-white/5 border border-white/5 rounded-2xl"},ro={class:"w-full text-left text-sm"},co={class:"divide-y divide-white/5"},uo={class:"p-4 font-mono text-zinc-500"},po={class:"p-4 font-bold text-zinc-200"},fo={class:"p-4"},vo={class:"px-2 py-1 rounded-md bg-zinc-800 border border-white/10 text-xs"},ho={key:0},xo={key:3,class:"space-y-6"},bo={key:0,class:"flex flex-col items-center justify-center py-20 text-zinc-500"},go={key:1,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"},yo={class:"flex items-center justify-between w-full"},mo={class:"flex items-center gap-3"},_o={class:"w-10 h-10 rounded-full bg-gradient-to-br from-zinc-700 to-zinc-800 flex items-center justify-center font-bold text-zinc-400"},wo={class:"font-bold text-zinc-200"},ko={class:"text-xs text-zinc-500 capitalize"},So=["onClick"],$o={key:0,class:"col-span-full p-8 text-center text-zinc-500 italic bg-white/5 rounded-xl border border-white/5 border-dashed"},zo={key:4,class:"space-y-6 h-full flex flex-col"},Co={class:"flex flex-wrap items-center gap-4 bg-white/5 p-4 rounded-xl border border-white/5"},Ao={class:"flex flex-col gap-1"},Eo={class:"flex flex-col gap-1"},Lo={class:"flex flex-col gap-1"},Io={class:"flex flex-col gap-1"},Mo={class:"flex-1 overflow-hidden bg-white/5 border border-white/5 rounded-2xl flex flex-col"},Ro={class:"overflow-y-auto custom-scrollbar flex-1"},Oo={class:"w-full text-left text-sm relative border-collapse"},Do={class:"divide-y divide-white/5"},Po={class:"p-3 font-mono text-zinc-500 text-xs whitespace-nowrap"},No={class:"p-3"},Uo={class:"p-3 text-zinc-200 font-medium"},To={class:"p-3 text-center font-mono text-zinc-500 text-xs"},jo={class:"p-3 text-zinc-400"},Bo={class:"p-3 font-mono text-zinc-500 text-xs"},Vo={key:0},Fo={key:1},Ho={class:"p-2 border-t border-white/5 bg-white/[0.02] text-xs text-zinc-500 text-right px-4"},Go={key:5,class:"h-full flex flex-col space-y-6"},Jo={key:0,class:"flex flex-col items-center justify-center py-20 text-zinc-500"},Wo={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-6 gap-6"},qo=["onClick"],Yo={class:"w-12 h-12 rounded-xl bg-zinc-800 text-zinc-500 flex items-center justify-center group-hover:bg-teal-500/20 group-hover:text-teal-400 transition-all"},Xo={class:"text-center relative z-10"},Qo={class:"font-bold text-zinc-300 group-hover:text-white transition-colors"},Zo={class:"text-[10px] text-zinc-500 uppercase tracking-widest font-mono"},Ko={class:"absolute bottom-3 right-3 opacity-0 group-hover:opacity-100 transition-all translate-y-2 group-hover:translate-y-0"},en={class:"bg-teal-500 text-zinc-950 p-1.5 rounded-lg shadow-lg"},tn={key:0,class:"col-span-full py-20 text-center border border-white/5 border-dashed rounded-3xl"},sn={key:6,class:"h-full flex flex-col space-y-4"},on={class:"flex gap-4 h-full"},nn={class:"w-64 flex flex-col bg-white/5 border border-white/5 rounded-xl overflow-hidden shrink-0"},ln={class:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1"},an={key:0,class:"p-4 text-center text-teal-500 animate-pulse"},rn=["onClick"],cn={class:"truncate"},dn={key:1,class:"p-4 text-center text-zinc-500 text-xs italic"},un={class:"flex-1 bg-white/5 border border-white/5 rounded-xl flex flex-col relative overflow-hidden"},pn={class:"p-4 border-b border-white/5 bg-white/[0.02] flex items-center justify-between"},fn={class:"flex items-center gap-3"},vn={class:"text-[10px] text-zinc-400 font-medium"},hn={class:"flex-1 relative p-6 overflow-y-auto custom-scrollbar flex flex-col"},xn={key:0,class:"space-y-6"},bn={class:"flex flex-wrap items-center gap-6 p-4 bg-white/5 rounded-xl border border-white/10 mb-2"},gn={class:"flex items-center gap-3"},yn={class:"w-8 h-8 rounded-lg bg-zinc-800 flex items-center justify-center"},mn={class:"flex items-center gap-3"},_n={class:"w-8 h-8 rounded-lg bg-zinc-800 flex items-center justify-center"},wn={class:"text-sm font-black text-zinc-100 uppercase italic"},kn={class:"w-24 text-right text-xs font-bold text-zinc-500 uppercase tracking-wider"},Sn={class:"flex-1 h-8 bg-black/40 rounded-lg relative overflow-hidden ring-1 ring-white/5"},$n=["title"],zn={key:1,class:"absolute inset-0 flex flex-col items-center justify-center bg-zinc-900/50 backdrop-blur-sm"},Cn={key:2,class:"absolute inset-0 flex flex-col items-center justify-center"},An={key:3,class:"absolute inset-0 flex flex-col items-center justify-center"},En=de({__name:"DeviceDetailView",setup(S){const w=Ie(),r=Re(),E=De(),o=Ye(),c=Xe(),x=_e(),k=we(),_=ke(),u=m(!1),h=be("notify"),p=w.params.id,f=m("info"),g=[{id:"info",label:"System Info",icon:ve},{id:"live",label:"Live View",icon:Y},{id:"storage",label:"Storage",icon:xe},{id:"integration",label:"Integration",icon:Je},{id:"logs",label:"System Log",icon:He},{id:"users",label:"User & Permission",icon:qe},{id:"scheduler",label:"Scheduler",icon:Ne}],I=te(()=>{switch(f.value){case"info":return o.loading.info;case"storage":return o.loading.storage;case"integration":return o.loading.onvif;case"users":return o.loading.users||_.loading.syncAll;case"logs":return c.loading;case"scheduler":return x.loading.channels||x.loading.mode||x.loading.sync;case"live":return k.loading.config||k.loading.update||k.loading.sync;default:return!1}});Me(async()=>{E.devices.length===0&&await E.fetchDevices(),f.value==="info"&&U()}),ee(f,L=>{switch(L){case"info":o.systemInfo||U();break;case"storage":o.storageList.length===0&&o.fetchStorage(p);break;case"integration":o.onvifUsers.length===0&&o.fetchOnvifUsers(p);break;case"users":o.deviceUsers.length===0&&o.fetchDeviceUsers(p);break;case"live":case"scheduler":x.channels.length===0&&x.fetchChannels(p);break}});const U=async()=>{try{await o.fetchSystemInfo(p)}catch{}},G=async()=>{try{if(f.value==="info")await o.syncSystemInfo(p);else if(f.value==="storage")await o.syncStorage(p);else if(f.value==="integration")await o.syncOnvifUsers(p);else if(f.value==="users")await _.syncAllUsers(p),await o.fetchDeviceUsers(p);else if(f.value==="scheduler")if(b.value)await x.syncRecordingMode(p,b.value);else{h("Info","Please select a channel to sync","info");return}h("Synced","Data updated from device","success")}catch{h("Error","Failed to sync data","error")}},Q=async()=>{try{await x.syncAllRecordingModes(p),h("Success","All schedules synced","success")}catch(L){h("Error",L.message||"Sync failed","error")}},F=L=>{const s=L.getTimezoneOffset()*6e4;return new Date(L.getTime()-s).toISOString().slice(0,16)},M=m(F(new Date(new Date().setDate(new Date().getDate()-1)))),a=m(F(new Date)),d=async()=>{c.dateFrom=new Date(M.value),c.dateTo=new Date(a.value);try{await c.fetchLogs(p)}catch{h("Error","Failed to fetch logs","error")}},b=m(null);ee(b,L=>{L&&x.fetchRecordingMode(p,L)});const z=te(()=>b.value?x.channelModes[b.value]:null);function J(L,s=!1){if(!L)return 0;const[l,N,R]=L.split(":").map(Number),W=(l||0)*3600+(N||0)*60+(R||0);return s&&W===0?86400:W}function ne(L,s){const l=x.channelModes[L];if(!l||!l.timeline)return[];const N=x.DAYS[s];return l.timeline.filter(R=>R.day_start===N).map(R=>{const W=J(R.time_start),Ce=R.day_end!==R.day_start,Ae=J(R.time_end,Ce||R.time_end==="00:00:00"),fe=86400,Ee=W/fe*100;let re=(Ae-W)/fe*100;return re>100&&(re=100),{startPct:Math.max(0,Ee),widthPct:Math.max(0,re),mode:R.mode,startTime:R.time_start,endTime:R.time_end}})}const le=m(!1),ae=m(null);function Se(L){ae.value=L,le.value=!0}function $e(){le.value=!1,ae.value=null}const ie=m(!1),pe=m(null);function ze(L){pe.value=L,ie.value=!0}return(L,s)=>(n(),i("div",us,[e("div",ps,[e("div",{class:P(["glass-card flex flex-col overflow-hidden shrink-0 border-white/5 transition-all duration-300 relative",u.value?"w-20":"w-64"])},[e("div",fs,[e("button",{onClick:s[0]||(s[0]=l=>t(r).push("/")),class:"flex items-center gap-2 text-zinc-400 hover:text-zinc-200 transition-colors mb-4 whitespace-nowrap overflow-hidden"},[y(t(Be),{class:"w-4 h-4 shrink-0"}),u.value?A("",!0):(n(),i("span",vs,"Back to Devices"))]),e("div",hs,[e("h3",xs,[y(t(Y),{class:"w-5 h-5 text-teal-400 shrink-0"}),u.value?A("",!0):(n(),i("span",bs,"Device Details"))]),e("button",{onClick:s[1]||(s[1]=l=>u.value=!u.value),class:"p-1.5 hover:bg-white/10 rounded-lg text-zinc-500 hover:text-white transition-colors shrink-0",title:u.value?"Expand Sidebar":"Collapse Sidebar"},[u.value?(n(),H(t(ye),{key:1,class:"w-4 h-4"})):(n(),H(t(Te),{key:0,class:"w-4 h-4"}))],8,gs)]),!u.value&&t(E).devices.find(l=>l.id==t(w).params.id)?(n(),i("p",ys,v(t(E).devices.find(l=>l.id==t(w).params.id)?.ipNvr),1)):A("",!0)]),e("div",ms,[(n(),i(O,null,D(g,l=>e("button",{key:l.id,onClick:N=>f.value=l.id,class:P(["w-full flex items-center p-3 rounded-lg transition-all duration-200 text-sm font-medium whitespace-nowrap overflow-hidden",[f.value===l.id?"bg-teal-500/20 text-teal-400 border border-teal-500/30":"hover:bg-white/5 text-zinc-400 border border-transparent",u.value?"justify-center gap-0":"gap-3"]]),title:u.value?l.label:""},[(n(),H(Oe(l.icon),{class:"w-4 h-4 shrink-0"})),u.value?A("",!0):(n(),i("span",ws,v(l.label),1))],10,_s)),64))])],2),e("div",ks,[e("div",Ss,[e("h2",$s,v(g.find(l=>l.id===f.value)?.label),1),e("div",zs,[["info","storage","integration","users"].includes(f.value)?(n(),i("button",{key:0,onClick:G,disabled:I.value,class:"flex items-center gap-2 px-4 py-2 bg-teal-500/10 hover:bg-teal-500/20 text-teal-400 border border-teal-500/30 rounded-lg text-sm font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed"},[y(t(oe),{class:P(["w-4 h-4",{"animate-spin":I.value}])},null,8,["class"]),T(" Sync "+v(g.find(l=>l.id===f.value)?.label),1)],8,Cs)):A("",!0),f.value==="scheduler"?(n(),i("button",{key:1,onClick:Q,disabled:t(x).loading.syncAll,class:"flex items-center gap-2 px-4 py-2 bg-teal-500/10 hover:bg-teal-500/20 text-teal-400 border border-teal-500/30 rounded-lg text-sm font-bold transition-all disabled:opacity-50"},[y(t(oe),{class:P(["w-4 h-4",{"animate-spin":t(x).loading.syncAll}])},null,8,["class"]),s[9]||(s[9]=T(" Sync All Schedules ",-1))],8,As)):A("",!0)])]),e("div",Es,[f.value==="info"?(n(),i("div",Ls,[t(o).loading.info&&!t(o).systemInfo?(n(),i("div",Is,[y(t(V),{class:"w-10 h-10 animate-spin mb-4 text-teal-500"}),s[10]||(s[10]=e("p",null,"Fetching system information...",-1))])):t(o).systemInfo?(n(),i("div",Ms,[e("div",Rs,[s[11]||(s[11]=e("span",{class:"text-[10px] uppercase font-bold tracking-widest text-zinc-500"},"Device Model",-1)),e("p",Os,v(t(o).systemInfo.model||"N/A"),1)]),e("div",Ds,[s[12]||(s[12]=e("span",{class:"text-[10px] uppercase font-bold tracking-widest text-zinc-500"},"Serial Number",-1)),e("p",Ps,v(t(o).systemInfo.serial_number||"N/A"),1)]),e("div",Ns,[s[13]||(s[13]=e("span",{class:"text-[10px] uppercase font-bold tracking-widest text-zinc-500"},"Firmware Version",-1)),e("p",Us,v(t(o).systemInfo.firmware_version||"N/A"),1)]),e("div",Ts,[s[14]||(s[14]=e("span",{class:"text-[10px] uppercase font-bold tracking-widest text-zinc-500"},"MAC Address",-1)),e("p",js,v(t(o).systemInfo.mac_address||"N/A"),1)])])):(n(),i("div",Bs,[y(t(ve),{class:"w-12 h-12 mx-auto text-zinc-600 mb-4"}),s[15]||(s[15]=e("p",{class:"text-zinc-500 mb-4"},"No system info available. Please sync from device.",-1)),e("button",{onClick:G,class:"px-6 py-2 bg-teal-500 text-zinc-950 font-bold rounded-xl hover:bg-teal-400 transition-colors"}," Sync Now ")]))])):f.value==="storage"?(n(),i("div",Vs,[t(o).loading.storage&&t(o).storageList.length===0?(n(),i("div",Fs,[y(t(V),{class:"w-10 h-10 animate-spin mb-4 text-teal-500"}),s[16]||(s[16]=e("p",null,"Loading storage info...",-1))])):t(o).storageList.length>0?(n(),i("div",Hs,[(n(!0),i(O,null,D(t(o).storageList,l=>(n(),i("div",{key:l.hdd_id,class:"p-5 bg-white/5 border border-white/5 rounded-xl space-y-3"},[e("div",Gs,[e("span",Js,v(l.hdd_name),1),e("span",Ws,v(l.status),1)]),e("div",qs,[e("div",Ys,[s[17]||(s[17]=e("span",null,"Type:",-1)),s[18]||(s[18]=T()),e("span",Xs,v(l.hdd_type),1)]),e("div",Qs,[s[19]||(s[19]=e("span",null,"Property:",-1)),s[20]||(s[20]=T()),e("span",Zs,v(l.property),1)]),e("div",Ks,[s[21]||(s[21]=e("span",null,"Capacity:",-1)),e("span",eo,v((l.capacity/1024).toFixed(2))+" GB",1)]),e("div",to,[s[22]||(s[22]=e("span",null,"Free:",-1)),e("span",so,v((l.free_space/1024).toFixed(2))+" GB",1)])]),e("div",oo,[e("div",{class:"h-full bg-teal-500",style:se({width:`${(l.capacity-l.free_space)/l.capacity*100}%`})},null,4)])]))),128))])):(n(),i("div",no,[y(t(xe),{class:"w-12 h-12 mx-auto text-zinc-600 mb-4"}),s[23]||(s[23]=e("p",{class:"text-zinc-500"},"No storage devices found.",-1))]))])):f.value==="integration"?(n(),i("div",lo,[t(o).loading.onvif&&t(o).onvifUsers.length===0?(n(),i("div",ao,[y(t(V),{class:"w-10 h-10 animate-spin mb-4 text-teal-500"}),s[24]||(s[24]=e("p",null,"Loading ONVIF users...",-1))])):(n(),i("div",io,[e("table",ro,[s[26]||(s[26]=e("thead",{class:"bg-white/5 text-zinc-400 font-bold uppercase tracking-wider text-xs"},[e("tr",null,[e("th",{class:"p-4"},"User ID"),e("th",{class:"p-4"},"Username"),e("th",{class:"p-4"},"Level")])],-1)),e("tbody",co,[(n(!0),i(O,null,D(t(o).onvifUsers,l=>(n(),i("tr",{key:l.user_id,class:"hover:bg-white/5 transition-colors"},[e("td",uo,v(l.user_id),1),e("td",po,v(l.username),1),e("td",fo,[e("span",vo,v(l.level),1)])]))),128)),t(o).onvifUsers.length===0?(n(),i("tr",ho,[...s[25]||(s[25]=[e("td",{colspan:"3",class:"p-8 text-center text-zinc-500 italic"}," No ONVIF users found ",-1)])])):A("",!0)])])]))])):f.value==="users"?(n(),i("div",xo,[t(o).loading.users&&t(o).deviceUsers.length===0?(n(),i("div",bo,[y(t(V),{class:"w-10 h-10 animate-spin mb-4 text-teal-500"}),s[27]||(s[27]=e("p",null,"Loading device users...",-1))])):(n(),i("div",go,[(n(!0),i(O,null,D(t(o).deviceUsers,l=>(n(),i("div",{key:l.id,class:"p-5 bg-white/5 border border-white/5 rounded-xl flex flex-col gap-3 group"},[e("div",yo,[e("div",mo,[e("div",_o,v(l.user_name.charAt(0).toUpperCase()),1),e("div",null,[e("p",wo,v(l.user_name),1),e("p",ko,v(l.role),1)])])]),e("button",{onClick:N=>ze(l),class:"w-full py-2 text-xs font-bold text-zinc-400 bg-black/20 hover:bg-teal-500/10 hover:text-teal-400 rounded-lg transition-colors flex items-center justify-center gap-2"},[y(t(ce),{class:"w-3 h-3"}),s[28]||(s[28]=T(" Permissions ",-1))],8,So)]))),128)),t(o).deviceUsers.length===0?(n(),i("div",$o," No users found. ")):A("",!0)]))])):f.value==="logs"?(n(),i("div",zo,[e("div",Co,[e("div",Ao,[s[29]||(s[29]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500"},"From",-1)),j(e("input",{type:"datetime-local","onUpdate:modelValue":s[2]||(s[2]=l=>M.value=l),class:"bg-black/20 border border-white/10 rounded px-3 py-1.5 text-xs text-zinc-200 focus:outline-none focus:border-teal-500/50"},null,512),[[Z,M.value]])]),e("div",Eo,[s[30]||(s[30]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500"},"To",-1)),j(e("input",{type:"datetime-local","onUpdate:modelValue":s[3]||(s[3]=l=>a.value=l),class:"bg-black/20 border border-white/10 rounded px-3 py-1.5 text-xs text-zinc-200 focus:outline-none focus:border-teal-500/50"},null,512),[[Z,a.value]])]),e("div",Lo,[s[32]||(s[32]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500"},"Log Type",-1)),j(e("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>t(c).majorType=l),class:"bg-black/20 border border-white/10 rounded px-3 py-1.5 text-xs text-zinc-200 focus:outline-none focus:border-teal-500/50 min-w-[120px]"},[...s[31]||(s[31]=[e("option",{value:"ALL"},"All Types",-1),e("option",{value:"Alarm"},"Alarm",-1),e("option",{value:"Exception"},"Exception",-1),e("option",{value:"Operation"},"Operation",-1)])],512),[[X,t(c).majorType]])]),e("div",Io,[s[34]||(s[34]=e("label",{class:"text-[10px] uppercase font-bold text-zinc-500"},"Limit",-1)),j(e("select",{"onUpdate:modelValue":s[5]||(s[5]=l=>t(c).maxResults=l),class:"bg-black/20 border border-white/10 rounded px-3 py-1.5 text-xs text-zinc-200 focus:outline-none focus:border-teal-500/50"},[...s[33]||(s[33]=[e("option",{value:50},"50",-1),e("option",{value:100},"100",-1),e("option",{value:500},"500",-1),e("option",{value:1e3},"1000",-1),e("option",{value:2e3},"2000",-1)])],512),[[X,t(c).maxResults]])]),e("button",{onClick:d,class:"mt-auto px-6 py-1.5 bg-teal-500 text-zinc-950 font-bold rounded hover:bg-teal-400 transition-colors text-sm flex items-center gap-2"},[y(t(je),{class:"w-4 h-4"}),s[35]||(s[35]=T(" Search ",-1))])]),e("div",Mo,[e("div",Ro,[e("table",Oo,[s[38]||(s[38]=e("thead",{class:"sticky top-0 bg-zinc-900/90 backdrop-blur z-10 text-zinc-400 font-bold uppercase tracking-wider text-xs shadow-sm"},[e("tr",null,[e("th",{class:"p-4 border-b border-white/5"},"Time"),e("th",{class:"p-4 border-b border-white/5"},"Type (Major)"),e("th",{class:"p-4 border-b border-white/5"},"Content (Minor)"),e("th",{class:"p-4 border-b border-white/5 text-center"},"CH"),e("th",{class:"p-4 border-b border-white/5"},"User"),e("th",{class:"p-4 border-b border-white/5"},"IP")])],-1)),e("tbody",Do,[(n(!0),i(O,null,D(t(c).logs,(l,N)=>(n(),i("tr",{key:N,class:"hover:bg-white/5 transition-colors"},[e("td",Po,v(l.time.replace("T"," ")),1),e("td",No,[e("span",{class:P(["px-2 py-1 rounded text-[10px] font-black uppercase tracking-widest border border-white/10",{"bg-rose-500/10 text-rose-400 border-rose-500/20":l.majorType==="Alarm","bg-amber-500/10 text-amber-400 border-amber-500/20":l.majorType==="Exception","bg-blue-500/10 text-blue-400 border-blue-500/20":l.majorType==="Operation"}])},v(l.majorType),3)]),e("td",Uo,v(t(c).getMinorLabel(l.minorType)),1),e("td",To,v(l.localId||"-"),1),e("td",jo,v(l.userName),1),e("td",Bo,v(l.ipAddress),1)]))),128)),!t(c).loading&&t(c).logs.length===0?(n(),i("tr",Vo,[...s[36]||(s[36]=[e("td",{colspan:"6",class:"p-10 text-center text-zinc-500 italic"}," No logs found. Try adjusting filters. ",-1)])])):A("",!0),t(c).loading?(n(),i("tr",Fo,[...s[37]||(s[37]=[e("td",{colspan:"6",class:"p-10 text-center text-teal-500 animate-pulse"}," Loading logs... ",-1)])])):A("",!0)])])]),e("div",Ho," Total Records: "+v(t(c).total),1)])])):f.value==="live"?(n(),i("div",Go,[t(x).loading.channels?(n(),i("div",Jo,[y(t(V),{class:"w-10 h-10 animate-spin mb-4 text-teal-500"}),s[39]||(s[39]=e("p",null,"Loading channels...",-1))])):(n(),i("div",Wo,[(n(!0),i(O,null,D(t(x).channels,l=>(n(),i("div",{key:l.id,onClick:N=>Se(l),class:"group aspect-video bg-white/5 border border-white/5 rounded-2xl hover:bg-teal-500/10 hover:border-teal-500/30 transition-all cursor-pointer relative overflow-hidden flex flex-col items-center justify-center gap-3 p-4"},[s[40]||(s[40]=e("div",{class:"absolute inset-0 bg-gradient-to-br from-teal-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"},null,-1)),e("div",Yo,[y(t(Y),{class:"w-6 h-6"})]),e("div",Xo,[e("p",Qo,v(l.channel_no||l.name),1),e("p",Zo," CH "+v(l.channel_no),1)]),e("div",Ko,[e("div",en,[y(t(me),{class:"w-3 h-3 fill-current"})])])],8,qo))),128)),t(x).channels.length===0?(n(),i("div",tn,[y(t(Y),{class:"w-12 h-12 mx-auto text-zinc-700 mb-4 opacity-50"}),s[41]||(s[41]=e("p",{class:"text-zinc-500"},"No channels available for this device.",-1))])):A("",!0)]))])):f.value==="scheduler"?(n(),i("div",sn,[e("div",on,[e("div",nn,[s[42]||(s[42]=e("div",{class:"p-3 border-b border-white/5 bg-white/[0.02] text-xs font-bold uppercase tracking-wider text-zinc-400"}," Channels ",-1)),e("div",ln,[t(x).loading.channels?(n(),i("div",an,[y(t(V),{class:"w-5 h-5 mx-auto animate-spin"})])):A("",!0),(n(!0),i(O,null,D(t(x).channels,l=>(n(),i("button",{key:l.id,onClick:N=>b.value=l.id,class:P(["w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center justify-between group",b.value===l.id?"bg-teal-500/20 text-teal-400 font-bold border border-teal-500/30":"text-zinc-400 hover:bg-white/5 hover:text-zinc-200"])},[e("span",cn,v(l.name||l.channel_no),1),y(t(he),{class:"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"})],10,rn))),128)),!t(x).loading.channels&&t(x).channels.length===0?(n(),i("div",dn," No channels found ")):A("",!0)])]),e("div",un,[e("div",pn,[s[43]||(s[43]=e("h3",{class:"font-bold text-zinc-200"},"Recording Schedule",-1)),e("div",fn,[(n(!0),i(O,null,D(t(x).MODE_CONFIG,(l,N)=>(n(),i("div",{key:N,class:"flex items-center gap-1.5"},[e("div",{class:P(["w-2.5 h-2.5 rounded-sm shadow-sm",{[l.color]:!0}])},null,2),e("span",vn,v(l.label),1)]))),128))])]),e("div",hn,[z.value?(n(),i("div",xn,[e("div",bn,[e("div",gn,[e("div",yn,[y(t(ce),{class:"w-4 h-4 text-teal-400"})]),e("div",null,[s[44]||(s[44]=e("p",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-widest"},"Schedule Status",-1)),e("p",{class:P([z.value.schedule_enable?"text-emerald-400":"text-rose-400","text-sm font-black uppercase italic"])},v(z.value.schedule_enable?"Active":"Disabled"),3)])]),e("div",mn,[e("div",_n,[y(t(Y),{class:"w-4 h-4 text-teal-400"})]),e("div",null,[s[45]||(s[45]=e("p",{class:"text-[10px] uppercase font-bold text-zinc-500 tracking-widest"},"Default Record Mode",-1)),e("p",wn,v(t(x).MODE_CONFIG[z.value.default_mode]?.label||z.value.default_mode),1)])])]),(n(!0),i(O,null,D(t(x).DAYS,(l,N)=>(n(),i("div",{key:l,class:"flex items-center gap-4"},[e("div",kn,v(l),1),e("div",Sn,[(n(!0),i(O,null,D(ne(b.value,N),(R,W)=>(n(),i("div",{key:W,class:P(["absolute top-0 bottom-0 h-full border-r border-black/10 transition-all hover:brightness-110 cursor-help",t(x).MODE_CONFIG[R.mode]?.color||"bg-zinc-700"]),style:se({left:`${R.startPct}%`,width:`${R.widthPct}%`}),title:`${R.startTime} - ${R.endTime} (${t(x).MODE_CONFIG[R.mode]?.label})`},null,14,$n))),128))])]))),128))])):b.value&&t(x).loading.mode?(n(),i("div",zn,[y(t(V),{class:"w-10 h-10 animate-spin text-teal-500 mb-2"}),s[46]||(s[46]=e("span",{class:"text-zinc-500 text-sm animate-pulse"},"Fetching schedule...",-1))])):b.value?(n(),i("div",An,[s[48]||(s[48]=e("span",{class:"text-zinc-500"},"No schedule data available or sync required.",-1)),e("button",{onClick:G,class:"mt-4 px-4 py-2 bg-teal-500/10 text-teal-400 rounded-lg hover:bg-teal-500/20 text-sm font-bold"}," Sync Channel ")])):(n(),i("div",Cn,[y(t(he),{class:"w-16 h-16 text-zinc-700 mb-4"}),s[47]||(s[47]=e("span",{class:"text-zinc-500"},"Select a channel to view schedule",-1))]))])])])])):A("",!0)])])]),y(wt,{"is-open":ie.value,user:pe.value,"device-id":t(p),onClose:s[6]||(s[6]=l=>ie.value=!1),onSaved:s[7]||(s[7]=l=>t(h)("Saved","Permissions updated","success"))},null,8,["is-open","user","device-id"]),y(ds,{"is-open":le.value,channel:ae.value,"device-id":t(p),onClose:$e,onSaved:s[8]||(s[8]=l=>t(h)("Saved","Configuration applied","success"))},null,8,["is-open","channel","device-id"])]))}}),Jn=ue(En,[["__scopeId","data-v-ba1a1da1"]]);export{Jn as default};
